## Troubleshooting performance of tableau live connections to SQL Server

Hello everyone, wish you enjoy reading these findings I've gathered over a couple of years working with this type of scenario

#### Background

Tableau and SQL Server are great tools but they may be troublesome to set working together.

There are use cases when you'd want to use *live* connection as opposed to *extracts*. These include, but not limited to cases when you want to use:
* integrated authentication in the DB,
* minimize storage footprint at the tableau server, 
* or your application requires that live data is retrieved from the DB
and many others.

The problem is, this might not perform well out-of-the box.

#### Problem description

An often occuring problem is performance of such connections. You may have just a handful (<< 1mln) of rows in the source tables, but the dashboards would take minutes to load.
This is especially true when you are getting data from a view (or a chain of views), not from a table.

> A note here: such design (chaining views) has been critisized a lot for poor performance - I even saw it taggedÂ bad practice - but I'm a big supporter of that because it saves a lot of coding and code maintenance. I will probably blog about it at some point; for now - don't rush to materialize everything to tables.

#### Why does it happen?

> note: if you want to skip to a list of concrete troubleshooting steps, please read part 2.

Let's review what is happenning every time when a user presses a refresh button. I may be drawing a simplified and not 100% strict description here, but I believe it is usable.

Every time user clicks refresh:
1. Tableau engine would create a set of SQL queries it deems necessary to (optimally) retrieve data from the DB.
2. These queries are then executed at the SQL server in some order,
3. The DB, having received a query, determines the (optimal) execution plan and sends the results back to Tableau
4. Tableau renders them in your viz.

The problems mainly happen because the SQL code generated by Tableau on step #1 is *tough* for the DB engine to optimize on step #3. And SQL Server takes a suboptimal execution path leading to long waits. In other words, your database needs *the right design* to perform well in such scenarios.

#### I want to see the problem with my own eyes, how do I do this?

Well, there are (at least) 2 good ways to do this:
1. Using tableau performance recording feature,
   - (TBC)
3. Using the sp_whoisactive stored procedure,
   - (TBC)

Now that you know how to see the exact queries that are executed on the server, you can skip to part 2.
